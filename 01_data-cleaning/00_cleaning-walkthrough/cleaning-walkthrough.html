<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Data Cleaning Walkthrough: Clean the iris Dataset</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="cleaning-walkthrough_files/libs/clipboard/clipboard.min.js"></script>
<script src="cleaning-walkthrough_files/libs/quarto-html/quarto.js"></script>
<script src="cleaning-walkthrough_files/libs/quarto-html/popper.min.js"></script>
<script src="cleaning-walkthrough_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="cleaning-walkthrough_files/libs/quarto-html/anchor.min.js"></script>
<link href="cleaning-walkthrough_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="cleaning-walkthrough_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="cleaning-walkthrough_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="cleaning-walkthrough_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="cleaning-walkthrough_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Data Cleaning Walkthrough: Clean the iris Dataset</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="objective" class="level1">
<h1>Objective</h1>
<p><strong>This is a guided walkthrough and may not be submitted for credit.</strong></p>
<p>The objective of this walkthrough is to demonstrate cleaning and transforming a messy dataset using tidyverse functions. Each step explains what to do and why, then provides code to carry it out.</p>
<p>To use this guide, read through each section and run the code in each chunk as you go. As you review, consider whether there are alternative ways to achieve the same result.</p>
<p>At the end of the document, there is a code chunk for you to practice constructing a complete, single pipeline to accomplish the same tasks. Try to recreate this pipeline on your own, referring to the walkthrough as needed.</p>
<p>After completing this guided walkthrough, you should be able to complete the Level 1 Data Cleaning Assignment. If you already feel very comfortable with the material, you should begin with the Level 2 Data Cleaning assignment. You may complete and submit either or both for credit.</p>
</section>
<section id="instructions" class="level1">
<h1>Instructions</h1>
<p>Just follow along! Open this quarto notebook and run chunks as you get to them. You can also render this document to HTML and view it in your browser or Viewer pane. I recommend the former so that you can play around with the code as you go.</p>
</section>
<section id="setup" class="level1">
<h1>Setup</h1>
<section id="loading-libraries-and-set-seed" class="level2">
<h2 class="anchored" data-anchor-id="loading-libraries-and-set-seed">Loading libraries and set seed</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.4     ✔ readr     2.1.5
✔ forcats   1.0.0     ✔ stringr   1.5.1
✔ ggplot2   3.5.1     ✔ tibble    3.2.1
✔ lubridate 1.9.3     ✔ tidyr     1.3.1
✔ purrr     1.0.2     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="read-in-and-inspect-messy-data" class="level2">
<h2 class="anchored" data-anchor-id="read-in-and-inspect-messy-data">Read in and inspect messy data</h2>
<p>Read in and inspect the messy dataset <code>messy-iris.csv</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: read-messy-data</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="do">### LEAVE THIS CHUNK AS-IS </span><span class="al">###</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co"># You *might* need to edit the filepath, but don't change anything else!</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Read in messy-iris.csv</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>messy.iris <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>  <span class="do">########################################</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">"messy-iris.csv"</span>, <span class="do">## &lt;-- THIS IS THE ONLY THING IN THIS CHUNK YOU CAN CHANGE IF NECESSARY</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># you may need to change the file path if your working directory has changed</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>  <span class="do">########################################</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">trim_ws =</span> <span class="cn">FALSE</span>, <span class="at">name_repair =</span> <span class="st">"minimal"</span>, <span class="at">col_types =</span> <span class="fu">cols</span>(<span class="at">.default =</span> <span class="fu">col_character</span>()))</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Inspect the data using head(), str(), and glimpse()</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Notice the differences in the information you get with each</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(messy.iris)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 5
  PetalWidth        SepalLength      FlowerSpecies  SepalWidth       PetalLength
  &lt;chr&gt;             &lt;chr&gt;            &lt;chr&gt;          &lt;chr&gt;            &lt;chr&gt;      
1 1,47457699002931  5,97238537280122 "VIRGINICA"    2,21501589812571 5,02128051…
2 1,55573361588642  6,00534585583955 " versicolor"  2,73298041442409 5,07811646…
3 0,156507294801995 4,55285815886687 "setosa"       3,60524568493012 1,02354059…
4 0,328616009263787 4,46317811898421 " setsoa"      2,26448698512046 1,26988187…
5 0,982654249703046 5,51327656765934 "versicolor"   2,36646466229577 3,69509664…
6 1,53510599342408  5,85590046376688 " versicolor " 3,01571652058279 4,16502750…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(messy.iris)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>spc_tbl_ [150 × 5] (S3: spec_tbl_df/tbl_df/tbl/data.frame)
 $ PetalWidth   : chr [1:150] "1,47457699002931" "1,55573361588642" "0,156507294801995" "0,328616009263787" ...
 $ SepalLength  : chr [1:150] "5,97238537280122" "6,00534585583955" "4,55285815886687" "4,46317811898421" ...
 $ FlowerSpecies: chr [1:150] "VIRGINICA" " versicolor" "setosa" " setsoa" ...
 $ SepalWidth   : chr [1:150] "2,21501589812571" "2,73298041442409" "3,60524568493012" "2,26448698512046" ...
 $ PetalLength  : chr [1:150] "5,02128051583422" "5,07811646363931" "1,02354059573496" "1,26988187949872" ...
 - attr(*, "spec")=
  .. cols(
  ..   .default = col_character(),
  ..   PetalWidth = col_character(),
  ..   SepalLength = col_character(),
  ..   FlowerSpecies = col_character(),
  ..   SepalWidth = col_character(),
  ..   PetalLength = col_character()
  .. )
 - attr(*, "problems")=&lt;externalptr&gt; </code></pre>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(messy.iris)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 150
Columns: 5
$ PetalWidth    &lt;chr&gt; "1,47457699002931", "1,55573361588642", "0,1565072948019…
$ SepalLength   &lt;chr&gt; "5,97238537280122", "6,00534585583955", "4,5528581588668…
$ FlowerSpecies &lt;chr&gt; "VIRGINICA", " versicolor", "setosa", " setsoa", "versic…
$ SepalWidth    &lt;chr&gt; "2,21501589812571", "2,73298041442409", "3,6052456849301…
$ PetalLength   &lt;chr&gt; "5,02128051583422", "5,07811646363931", "1,0235405957349…</code></pre>
</div>
</div>
</section>
<section id="inspect-the-original-iris-dataset" class="level2">
<h2 class="anchored" data-anchor-id="inspect-the-original-iris-dataset">Inspect the original iris dataset</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="do">### LEAVE THIS CHUNK AS-IS </span><span class="al">###</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the original iris dataset</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(iris)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Inspect the data using head(), str(), and glimpse()</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Notice the differences in the information you get with each</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(iris)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Sepal.Length Sepal.Width Petal.Length Petal.Width Species
1          5.1         3.5          1.4         0.2  setosa
2          4.9         3.0          1.4         0.2  setosa
3          4.7         3.2          1.3         0.2  setosa
4          4.6         3.1          1.5         0.2  setosa
5          5.0         3.6          1.4         0.2  setosa
6          5.4         3.9          1.7         0.4  setosa</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(iris)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   150 obs. of  5 variables:
 $ Sepal.Length: num  5.1 4.9 4.7 4.6 5 5.4 4.6 5 4.4 4.9 ...
 $ Sepal.Width : num  3.5 3 3.2 3.1 3.6 3.9 3.4 3.4 2.9 3.1 ...
 $ Petal.Length: num  1.4 1.4 1.3 1.5 1.4 1.7 1.4 1.5 1.4 1.5 ...
 $ Petal.Width : num  0.2 0.2 0.2 0.2 0.2 0.4 0.3 0.2 0.2 0.1 ...
 $ Species     : Factor w/ 3 levels "setosa","versicolor",..: 1 1 1 1 1 1 1 1 1 1 ...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(iris)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 150
Columns: 5
$ Sepal.Length &lt;dbl&gt; 5.1, 4.9, 4.7, 4.6, 5.0, 5.4, 4.6, 5.0, 4.4, 4.9, 5.4, 4.…
$ Sepal.Width  &lt;dbl&gt; 3.5, 3.0, 3.2, 3.1, 3.6, 3.9, 3.4, 3.4, 2.9, 3.1, 3.7, 3.…
$ Petal.Length &lt;dbl&gt; 1.4, 1.4, 1.3, 1.5, 1.4, 1.7, 1.4, 1.5, 1.4, 1.5, 1.5, 1.…
$ Petal.Width  &lt;dbl&gt; 0.2, 0.2, 0.2, 0.2, 0.2, 0.4, 0.3, 0.2, 0.2, 0.1, 0.2, 0.…
$ Species      &lt;fct&gt; setosa, setosa, setosa, setosa, setosa, setosa, setosa, s…</code></pre>
</div>
</div>
<p>We can compare the messy and original datasets to identify the differences between them using either <code>all.equal()</code> or <code>diff_data()</code> from the <code>daff</code> package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare the messy and original datasets using all.equal()</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">all.equal</span>(messy.iris, iris)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "Names: 5 string mismatches"                                                            
 [2] "Attributes: &lt; Names: 1 string mismatch &gt;"                                              
 [3] "Attributes: &lt; Length mismatch: comparison on first 2 components &gt;"                     
 [4] "Attributes: &lt; Component \"class\": Lengths (4, 1) differ (string compare on first 1) &gt;"
 [5] "Attributes: &lt; Component \"class\": 1 string mismatch &gt;"                                
 [6] "Attributes: &lt; Component 2: target is externalptr, current is numeric &gt;"                
 [7] "Component 1: Modes: character, numeric"                                                
 [8] "Component 1: target is character, current is numeric"                                  
 [9] "Component 2: Modes: character, numeric"                                                
[10] "Component 2: target is character, current is numeric"                                  
[11] "Component 3: Modes: character, numeric"                                                
[12] "Component 3: target is character, current is numeric"                                  
[13] "Component 4: Modes: character, numeric"                                                
[14] "Component 4: target is character, current is numeric"                                  
[15] "Component 5: Modes: character, numeric"                                                
[16] "Component 5: Attributes: &lt; target is NULL, current is list &gt;"                          
[17] "Component 5: target is character, current is factor"                                   </code></pre>
</div>
</div>
<p>The <code>all.equal()</code> function will return a message indicating the differences between the two datasets. Here we’ve got a total of 17 differences.</p>
<!-- See what I did there with the `r`? That's an inline R expression, which is a handy way to include the results of R code in your text. Right now when I run this, I see 17 errors, but what if I change this guide in the future to make it easier or more complicated? This way, I don't have to remember to update the number in the text. That inline expression will always be accurate, while "17" could be wrong. -->
<p>Alternatively, we can use the <code>diff_data()</code> function from the <code>daff</code> package to identify the differences between the two datasets.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the daff package (install if necessary)</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(daff)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Use render_diff() and diff_data() to identify differences between messy.iris and iris</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a><span class="fu">diff_data</span>(messy.iris, iris)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Daff Comparison: 'messy.iris' vs. 'iris' 
  First 6 and last 6 patch lines:
    +++          +++         +++          +++         ---              
@@  Sepal.Length Sepal.Width Petal.Length Petal.Width PetalWidth       
+++ 5.1          3.5         1.4          0.2         &lt;NA&gt;             
+++ 4.9          3           1.4          0.2         &lt;NA&gt;             
+++ 4.7          3.2         1.3          0.2         &lt;NA&gt;             
+++ 4.6          3.1         1.5          0.2         &lt;NA&gt;             
+++ 5            3.6         1.4          0.2         &lt;NA&gt;             
... ...          ...         ...          ...         ...              
--- &lt;NA&gt;         &lt;NA&gt;        &lt;NA&gt;         &lt;NA&gt;        1,30200233520009 
--- &lt;NA&gt;         &lt;NA&gt;        &lt;NA&gt;         &lt;NA&gt;        0,402162140060682
--- &lt;NA&gt;         &lt;NA&gt;        &lt;NA&gt;         &lt;NA&gt;        2,23942190992413 
--- &lt;NA&gt;         &lt;NA&gt;        &lt;NA&gt;         &lt;NA&gt;        0,380174697295297
--- &lt;NA&gt;         &lt;NA&gt;        &lt;NA&gt;         &lt;NA&gt;        1,81001215967583 
--- &lt;NA&gt;         &lt;NA&gt;        &lt;NA&gt;         &lt;NA&gt;        2,33447004017886 
    ---              (FlowerSpecies) ---              ---             
@@  SepalLength      Species         SepalWidth       PetalLength     
+++ &lt;NA&gt;             setosa          &lt;NA&gt;             &lt;NA&gt;            
+++ &lt;NA&gt;             setosa          &lt;NA&gt;             &lt;NA&gt;            
+++ &lt;NA&gt;             setosa          &lt;NA&gt;             &lt;NA&gt;            
+++ &lt;NA&gt;             setosa          &lt;NA&gt;             &lt;NA&gt;            
+++ &lt;NA&gt;             setosa          &lt;NA&gt;             &lt;NA&gt;            
... ...              ...             ...              ...             
--- 6,57197125798091  versicolor     2,88512987361755 4,62607643010793
--- 5,01823669850361  setosa         3,37866495417664 1,61445680452278
--- 6,3992572409776   virginica      2,81143175488105 5,5611425713473 
--- 5,1353260206664  setsoa          3,77561534168199 1,90353447151603
--- 6,05775549731217 virginica       2,98510852428153 4,93908675212879
--- 7,73530943264952  virginica      2,63911517042667 6,90538676390657</code></pre>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="do">## you can do this with just daff_data(), but render_diff() will give you a pretty output in the viewer that can be easier to read, which is the point of using daff in the first place</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">render_diff</span>(<span class="fu">diff_data</span>(messy.iris, iris))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Which one is more helpful right now? I’d say <code>all.equal()</code> at this point. It actually tells us what some solvable problems are (though we do have to figure out how to interpret them). <code>diff_data()</code> just tells us that there are differences, but since right now the datasets are <em>very</em> different in structure, it can really only tell us that there are differences in every row (which was already pretty obvious).</p>
<p><strong>QUESTIONS:</strong></p>
<ol type="1">
<li>What are the differences between the messy dataset and the original iris dataset?</li>
</ol>
<ul>
<li>Columns are out of order</li>
<li>Column names don’t match</li>
<li>Data types are incorrect (all are character in messy, but numeric/factor in original)</li>
<li>Values in the species column have lots of problems (extra spaces, capitalization, typos, etc.)</li>
<li>Numbers have commas in them instead of periods</li>
<li>Numbers aren’t rounded to the same number of decimal places</li>
</ul>
<ol start="2" type="1">
<li>What are the steps you need to take to clean the messy dataset?</li>
</ol>
<ul>
<li>Rename columns</li>
<li>Reorder columns</li>
<li>Change data types: Species to factor, other columns to numeric</li>
<li>Correct values in Species column: remove extra spaces, fix typos, ensure consistent capitalization</li>
<li>Remove commas from numbers</li>
<li>Round numbers to the same number of decimal places (1)</li>
</ul>
<ol start="3" type="1">
<li>Are there any considerations for what order to do these steps in?</li>
</ol>
<ul>
<li>Changing data types should be done after fixing values in the Species column, since it will be easier to make the changes with strings than with factors</li>
<li>Renaming and reordering columns can be done at any point, but it might be easier to do it first so you can see the data in a more familiar format</li>
<li>Rounding numbers can only happen after those variables are numeric</li>
<li>If we want to use simple “find and replace” (e.g.&nbsp;grep-style) functions swap commas to periods, that should happen while they’re still strings
<ul>
<li>Since commas are actually a valid way to represent decimals in some countries, there may be functions that are specifically designed for this purpose that we could use instead (which probably take numeric values)</li>
</ul></li>
</ul>
</section>
</section>
<section id="clean-the-dataset" class="level1">
<h1>Clean the Dataset</h1>
<section id="create-clean-dataset" class="level2">
<h2 class="anchored" data-anchor-id="create-clean-dataset">Create “clean” dataset</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: make-cleaning-dataset</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a dataset to work with during the cleaning process called "clean.iris"</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>clean.iris <span class="ot">&lt;-</span> messy.iris</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="clean-column-names" class="level2">
<h2 class="anchored" data-anchor-id="clean-column-names">Clean column names</h2>
<p>We have multiple options for the rename and reorder (aka relocate) steps. We can use <code>rename()</code> and <code>relocate()</code> to do so in two discrete steps, or use <code>select()</code> to do it all at once.</p>
<p>Either way, start by looking at the column names and order in both the original and messy datasets.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: inspect-column-names</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Check the names and order of columns in iris:</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(iris)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Sepal.Length" "Sepal.Width"  "Petal.Length" "Petal.Width"  "Species"     </code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check the names and order of columns in messy.iris:</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(messy.iris)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "PetalWidth"    "SepalLength"   "FlowerSpecies" "SepalWidth"   
[5] "PetalLength"  </code></pre>
</div>
</div>
<section id="two-step-method" class="level3">
<h3 class="anchored" data-anchor-id="two-step-method">Two-step method</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: rename-columns</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename columns to match the original iris dataset with rename()</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>clean.iris <span class="ot">&lt;-</span> messy.iris <span class="sc">%&gt;%</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># The format is rename(new_name = old_name)</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Sepal.Length =</span> SepalLength, <span class="at">Sepal.Width =</span> SepalWidth, <span class="at">Petal.Length =</span> PetalLength, <span class="at">Petal.Width =</span> PetalWidth, <span class="at">Species =</span> FlowerSpecies)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If we take a look at the column names in our working dataset (<code>colnames(clean.iris)</code>), we can see that they are now in the correct format. However, the order of the columns is still incorrect. We can use the <code>relocate()</code> function to reorder the columns.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Reorder columns to match the original iris dataset with relocate()</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>clean.iris <span class="ot">&lt;-</span> clean.iris <span class="sc">%&gt;%</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(Sepal.Length, Sepal.Width, Petal.Length, Petal.Width, Species)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If we did this correctly, the column names for both should be identical, which we can check.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare the column names of clean.iris and iris</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="fu">all.equal</span>(<span class="fu">colnames</span>(clean.iris), <span class="fu">colnames</span>(iris))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
</section>
<section id="one-step-method" class="level3">
<h3 class="anchored" data-anchor-id="one-step-method">One-step method</h3>
<p>Both <code>rename()</code> and <code>relocate()</code> can be combined into a single step using <code>select()</code>. This is a more concise way to achieve the same result. In fact, both <code>rename()</code> and <code>relocate()</code> are actually just wrappers for <code>select()</code>, and use what’s called “select helpers” to do their work.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: select-columns</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="co"># The select() function can rename and reorder columns in one step</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="do">## Rename columns to match the original iris dataset the same as with the two-step method</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="do">## If we put them in the order of the original dataset, it will reorder at the same time</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>clean.iris <span class="ot">&lt;-</span> messy.iris <span class="sc">%&gt;%</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="at">Sepal.Length =</span> SepalLength, <span class="at">Sepal.Width =</span> SepalWidth, <span class="at">Petal.Length =</span> PetalLength, <span class="at">Petal.Width =</span> PetalWidth, <span class="at">Species =</span> FlowerSpecies)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>They should be identical, which we can check.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare the column names of clean.iris and iris</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="fu">all.equal</span>(<span class="fu">colnames</span>(clean.iris), <span class="fu">colnames</span>(iris))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
</div>
</section>
</section>
<section id="checkpoint-1" class="level2">
<h2 class="anchored" data-anchor-id="checkpoint-1">Checkpoint 1</h2>
<p>Let’s compare the two datasets again. Maybe we’ve fixed some of the issues that <code>all.equal()</code> flagged, and with that restructuring, maybe <code>diff_data()</code> will be more helpful now.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: checkpoint-1-allequal</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Inspect the current state of the dataset</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(clean.iris)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 5
  Sepal.Length     Sepal.Width      Petal.Length     Petal.Width       Species  
  &lt;chr&gt;            &lt;chr&gt;            &lt;chr&gt;            &lt;chr&gt;             &lt;chr&gt;    
1 5,97238537280122 2,21501589812571 5,02128051583422 1,47457699002931  "VIRGINI…
2 6,00534585583955 2,73298041442409 5,07811646363931 1,55573361588642  " versic…
3 4,55285815886687 3,60524568493012 1,02354059573496 0,156507294801995 "setosa" 
4 4,46317811898421 2,26448698512046 1,26988187949872 0,328616009263787 " setsoa"
5 5,51327656765934 2,36646466229577 3,69509664382553 0,982654249703046 "versico…
6 5,85590046376688 3,01571652058279 4,16502750666812 1,53510599342408  " versic…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Use all.equal() to check if clean.iris matches iris</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="fu">all.equal</span>(clean.iris, iris)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "Attributes: &lt; Component \"class\": Lengths (3, 1) differ (string compare on first 1) &gt;"
 [2] "Attributes: &lt; Component \"class\": 1 string mismatch &gt;"                                
 [3] "Component \"Sepal.Length\": Modes: character, numeric"                                 
 [4] "Component \"Sepal.Length\": target is character, current is numeric"                   
 [5] "Component \"Sepal.Width\": Modes: character, numeric"                                  
 [6] "Component \"Sepal.Width\": target is character, current is numeric"                    
 [7] "Component \"Petal.Length\": Modes: character, numeric"                                 
 [8] "Component \"Petal.Length\": target is character, current is numeric"                   
 [9] "Component \"Petal.Width\": Modes: character, numeric"                                  
[10] "Component \"Petal.Width\": target is character, current is numeric"                    
[11] "Component \"Species\": Modes: character, numeric"                                      
[12] "Component \"Species\": Attributes: &lt; target is NULL, current is list &gt;"                
[13] "Component \"Species\": target is character, current is factor"                         </code></pre>
</div>
</div>
<p>Now we’ve got 13 flagged differences, down from the 17. Progress!</p>
<p>What about <code>diff_data()</code>?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Use render_diff() and diff_data() to identify differences between clean.iris and iris</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="fu">render_diff</span>(<span class="fu">diff_data</span>(clean.iris, iris))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Still not super helpful.</p>
<section id="sort-rows" class="level3">
<h3 class="anchored" data-anchor-id="sort-rows">Sort rows</h3>
<p>Around now, when <code>diff_daff()</code> is so very uninformative, we might notice that the values in each row aren’t just a little off, they seem totally unrelated! Take a look a the <code>head()</code> of each:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(clean.iris)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 5
  Sepal.Length     Sepal.Width      Petal.Length     Petal.Width       Species  
  &lt;chr&gt;            &lt;chr&gt;            &lt;chr&gt;            &lt;chr&gt;             &lt;chr&gt;    
1 5,97238537280122 2,21501589812571 5,02128051583422 1,47457699002931  "VIRGINI…
2 6,00534585583955 2,73298041442409 5,07811646363931 1,55573361588642  " versic…
3 4,55285815886687 3,60524568493012 1,02354059573496 0,156507294801995 "setosa" 
4 4,46317811898421 2,26448698512046 1,26988187949872 0,328616009263787 " setsoa"
5 5,51327656765934 2,36646466229577 3,69509664382553 0,982654249703046 "versico…
6 5,85590046376688 3,01571652058279 4,16502750666812 1,53510599342408  " versic…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(iris)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Sepal.Length Sepal.Width Petal.Length Petal.Width Species
1          5.1         3.5          1.4         0.2  setosa
2          4.9         3.0          1.4         0.2  setosa
3          4.7         3.2          1.3         0.2  setosa
4          4.6         3.1          1.5         0.2  setosa
5          5.0         3.6          1.4         0.2  setosa
6          5.4         3.9          1.7         0.4  setosa</code></pre>
</div>
</div>
<p>We can immediately see that this isn’t just an issue of typos and rounding erros; the rows are in a totally different order. As long as this is the case, our comparison functions aren’t going to be helpful at the row level for things like identifying mismatched strings.</p>
<p>The first thought should be to figure out how <code>iris</code> is sorted so that we can match it, but that’s not going to be doable. Although <code>iris</code> has a natural order, there are no unique IDs for each row to match or sort by, and although there is <em>some</em> ordering by species, that won’t let us sort the individual rows within each species.</p>
<p>So what do we do? Thinking about it, isn’t this an aspect of the original <code>iris</code> dataset that doesn’t feel particularly “clean”? It’s not that the data is wrong, but we can make it easier to work with by sorting it in a way that makes sense. Then we can sort our <code>clean.iris</code> dataset in the same way.</p>
<p>We can use <code>arrange()</code> to sort the rows in both datasets by Species, then some order of our choosing.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: sort-rows</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Make a sorted.iris dataset to preserve the original if we need it later</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>sorted.iris <span class="ot">&lt;-</span> iris <span class="sc">%&gt;%</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(Species, Sepal.Length, Sepal.Width, Petal.Length, Petal.Width) <span class="co"># we don't really need to sort by all of these, since it's very unlikely that anything more than 1 or 2 of the measurements would be identical, but it can't hurt</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort clean.iris in the same way</span></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>clean.iris <span class="ot">&lt;-</span> clean.iris <span class="sc">%&gt;%</span></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(Species, Sepal.Length, Sepal.Width, Petal.Length, Petal.Width)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now let’s compare the two:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: checkpoint-1-sortrows </span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="fu">all.equal</span>(clean.iris, sorted.iris)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "Attributes: &lt; Component \"class\": Lengths (3, 1) differ (string compare on first 1) &gt;"
 [2] "Attributes: &lt; Component \"class\": 1 string mismatch &gt;"                                
 [3] "Component \"Sepal.Length\": Modes: character, numeric"                                 
 [4] "Component \"Sepal.Length\": target is character, current is numeric"                   
 [5] "Component \"Sepal.Width\": Modes: character, numeric"                                  
 [6] "Component \"Sepal.Width\": target is character, current is numeric"                    
 [7] "Component \"Petal.Length\": Modes: character, numeric"                                 
 [8] "Component \"Petal.Length\": target is character, current is numeric"                   
 [9] "Component \"Petal.Width\": Modes: character, numeric"                                  
[10] "Component \"Petal.Width\": target is character, current is numeric"                    
[11] "Component \"Species\": Modes: character, numeric"                                      
[12] "Component \"Species\": Attributes: &lt; target is NULL, current is list &gt;"                
[13] "Component \"Species\": target is character, current is factor"                         </code></pre>
</div>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">render_diff</span>(<span class="fu">diff_data</span>(clean.iris, sorted.iris))</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(clean.iris)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 5
  Sepal.Length     Sepal.Width      Petal.Length     Petal.Width        Species 
  &lt;chr&gt;            &lt;chr&gt;            &lt;chr&gt;            &lt;chr&gt;              &lt;chr&gt;   
1 4,25660729576833 2,97086414169753 1,12879785496742 0,13043260396691   " SETOS…
2 5,0263296912401  3,39485230933642 1,50335769378347 0,15048280026298   " SETOS…
3 5,6253280119854  3,0259987315     4,07476291585481 1,32160184757551   " VERSI…
4 5,99108663638588 2,95103695868514 4,8246164525277  1,75316358919488   " VIRGI…
5 6,1710145972576  3,38781531593064 5,42065705235815 2,29325684801443   " Virgi…
6 4,93755231583957 3,0802668381948  1,52785527009983 0,0598821436008438 " set0s…</code></pre>
</div>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(sorted.iris)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Sepal.Length Sepal.Width Petal.Length Petal.Width Species
1          4.3         3.0          1.1         0.1  setosa
2          4.4         2.9          1.4         0.2  setosa
3          4.4         3.0          1.3         0.2  setosa
4          4.4         3.2          1.3         0.2  setosa
5          4.5         2.3          1.3         0.3  setosa
6          4.6         3.1          1.5         0.2  setosa</code></pre>
</div>
</div>
<p>Well that kind of went nowhere! The rows don’t seem to be arranged the same way at all, and <code>diff_data()</code> is still not helpful. What went wrong?</p>
<p>They’re both sorted by the same criteria, but the <em>possible</em> values in the Species column are not the same in the two datasets. We need to fix the values in the Species column before sorting will be helpful.</p>
<p>Was this a waste of time? I don’t think so. We’ve learned some things we can use:</p>
<ol type="1">
<li>We identified a problem that we will need to be dealt with at some point, so we’ll be set up to do that later.</li>
<li>When we saw that it wasn’t super helpful now, we also identified the <em>why</em>, noting problems in the Species column that we need to fix.</li>
<li>Since we know why it didn’t work, we know when the next time we try it should be. We don’t need to do these comparisons or try to sort again until we have (at a minimum) fixed the Species column. As we move forward we should prioritize fixing that column so that we can use these tools to check our work.</li>
</ol>
</section>
</section>
<section id="clean-data-values" class="level2">
<h2 class="anchored" data-anchor-id="clean-data-values">Clean data values</h2>
<p>We need to change values in every single column, both the measurements and the species categories. We’ll also need to change the data types. We could tackle either the numeric stuff or the string/factor stuff first, but we learned in the step above that the Species column is holding us back. Let’s start there.</p>
<section id="clean-species-values" class="level3">
<h3 class="anchored" data-anchor-id="clean-species-values">Clean Species values</h3>
<p>Start by identifying what the unique values of Species are actually supposed to be. The column <code>iris$Species</code> is a factor, so we can use <code>levels()</code> to see what the possible values are.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: levels-species</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Check the levels of the Species column in the original iris dataset</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(iris<span class="sc">$</span>Species)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "setosa"     "versicolor" "virginica" </code></pre>
</div>
</div>
<p>Now we can compare these to the unique values in the messy dataset. The column <code>clean.iris$Species</code> is a character, so <code>levels()</code> won’t help us (levels necessarily belong to factors). We can use <code>unique()</code> to see what the possible values are in this character column.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: unique-species</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Check the unique values of the Species column in clean.iris</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(clean.iris<span class="sc">$</span>Species)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] " SETOSA"      " VERSICOLOR"  " VIRGINICA"   " Virginia "   " set0sa"     
 [6] " setosa"      " setosa "     " setsoa"      " versicolor"  " versicolor "
[11] " versicolour" " virginica"   " virginica "  "SETOSA"       "VERSICOLOR"  
[16] "VIRGINICA"    "Virginia"     "Virginia "    "set0sa"       "set0sa "     
[21] "setosa"       "setosa "      "setsoa"       "setsoa "      "versic0lor"  
[26] "versicolor"   "versicolor "  "versicolour"  "versicolour " "virginica"   
[31] "virginica "  </code></pre>
</div>
</div>
<p>The original dataset has three levels: “setosa”, “versicolor”, and “virginica”. The messy dataset has a billion (well, technically 31, but it’s a lot). Our job now is to spot patterns in the messy data that we can use to clean it up.</p>
<p>What patterns of errors are there?</p>
<ol type="1">
<li>Extra spaces, both at the beginnings and ends of the values</li>
<li>Inconsistent capitalization, with some values in all caps, some in all lowercase, and some mixed (everything is lower case in <code>iris$Species</code>)</li>
<li>There are some 0s in there, that’s weird, they should be the letter “o”</li>
</ol>
<p>We might notice that there are problems that don’t fall into these patterns, but they seem to be a little random. We’ll be able to fix these easier once we’ve taken care of the more systematic issues.</p>
<p>We’ll fix those patterned errors in one step:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: clean-species-patterns</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Use stringr to clean the Species column</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>clean.iris <span class="ot">&lt;-</span> clean.iris <span class="sc">%&gt;%</span></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Trim whitespace from the beginning and end of the string</span></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">Species =</span> <span class="fu">str_squish</span>(Species), <span class="co"># this is equivalent to str_trim(Species, side = "both"), but str_squish is more fun to say</span></span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Convert to lowercase</span></span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">Species =</span> <span class="fu">str_to_lower</span>(Species),</span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Replace 0 with o</span></span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">Species =</span> <span class="fu">str_replace_all</span>(Species, <span class="st">"0"</span>, <span class="st">"o"</span>) <span class="co"># we could also use str_replace(Species, "0", "o") since there is never more than one 0 in a row, but this is safer</span></span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we can look at the unique values in the Species column again to see what’s left:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: unique-species-2</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Check the unique values of the Species column in clean.iris after initial cleaning</span></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(clean.iris<span class="sc">$</span>Species)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "setosa"      "versicolor"  "virginica"   "virginia"    "setsoa"     
[6] "versicolour"</code></pre>
</div>
</div>
<p>Much better! Looks like values 1-3 are the same as the original dataset. There are only 3 unique values now, which is a good sign.) <!-- That incline code evaluates to 3 for me right now, but remember that using a dynamic expression like that is more robust. I change the data or the code, I don't have to remember to update the number in the text. --></p>
<p>Let’s fix these last few values:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: clean-species-typos</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Use stringr to clean the Species column</span></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>clean.iris <span class="ot">&lt;-</span> clean.iris <span class="sc">%&gt;%</span></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Replace "setsoa" with "setosa"</span></span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">Species =</span> <span class="fu">str_replace_all</span>(Species, <span class="st">"setsoa"</span>, <span class="st">"setosa"</span>),</span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Replace "versicolr" with "versicolor"</span></span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">Species =</span> <span class="fu">str_replace_all</span>(Species, <span class="st">"versicolour"</span>, <span class="st">"versicolor"</span>),</span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Replace "virginia" with "virginica"</span></span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">Species =</span> <span class="fu">str_replace_all</span>(Species, <span class="st">"virginia"</span>, <span class="st">"virginica"</span>)</span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Like above, we could have just used str_replace() since there is only one instance of each typo in each row, but unless you know that you specifically only want to target the first instance of something, the `_all` version of most stringr functions should be your default</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This should take care of all the mismatches, so let’s check:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: levels-species</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Check the levels of the Species column in the original iris dataset</span></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(iris<span class="sc">$</span>Species)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "setosa"     "versicolor" "virginica" </code></pre>
</div>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check the unique values of the Species column in clean.iris after final cleaning</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(clean.iris<span class="sc">$</span>Species)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "setosa"     "versicolor" "virginica" </code></pre>
</div>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Are they the same?</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(iris<span class="sc">$</span>Species) <span class="sc">==</span> <span class="fu">unique</span>(clean.iris<span class="sc">$</span>Species) <span class="co"># this will work even though one is a factor and the other a character because levels() and unique() both evaluate to vectors, and the values within those vectors are what is being compared</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE TRUE TRUE</code></pre>
</div>
</div>
<p>They match! The last thing to do is to convert the Species column to a factor.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: factor-species</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert the Species column to a factor</span></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>clean.iris <span class="ot">&lt;-</span> clean.iris <span class="sc">%&gt;%</span></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Species =</span> <span class="fu">factor</span>(Species))</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a><span class="do">## Note that in this case, the order of the levels doesn't matter. There's no intrinsic order to three species categories of flower. If we want them sorted later alphabetically or something we can do that later.</span></span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a><span class="do">## If this was a factor that DID have an intrinsic hierarchical order, we could specify that at this point by using: </span></span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a><span class="co"># factor(Species,</span></span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a><span class="co">#     levels = c("setosa", "versicolor", "virginica"),</span></span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a><span class="co">#     ordered = TRUE)</span></span>
<span id="cb63-14"><a href="#cb63-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-15"><a href="#cb63-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-16"><a href="#cb63-16" aria-hidden="true" tabindex="-1"></a><span class="co"># If we did it right the levels should be the same as the original dataset</span></span>
<span id="cb63-17"><a href="#cb63-17" aria-hidden="true" tabindex="-1"></a><span class="co"># We should use levels() for both now that they are both factors!</span></span>
<span id="cb63-18"><a href="#cb63-18" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(clean.iris<span class="sc">$</span>Species) <span class="sc">==</span> <span class="fu">levels</span>(iris<span class="sc">$</span>Species)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE TRUE TRUE</code></pre>
</div>
</div>
</section>
<section id="checkpoint-2" class="level3">
<h3 class="anchored" data-anchor-id="checkpoint-2">Checkpoint 2</h3>
<section id="sort-rows-take-2" class="level4">
<h4 class="anchored" data-anchor-id="sort-rows-take-2">Sort rows: Take 2</h4>
<p>Our Species column is fixed now, so let’s try sorting the rows again before comparing datasets programmatically. The work we did may or may not have been helpful yet, but since this is what we identified as the biggest problem, we should check.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: sort-rows-take-2</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Make a sorted.iris dataset to preserve the original if we need it later</span></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a><span class="do">## We don't actually need to do this since we already did it in the chunk above, but if you were working on your own data you probably would have cut that chunk since it wasn't very useful. It that case you'd need to define that object here.</span></span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>sorted.iris <span class="ot">&lt;-</span> iris <span class="sc">%&gt;%</span></span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(Species, Sepal.Length, Sepal.Width, Petal.Length, Petal.Width) <span class="co"># we don't really need to sort by all of these, since it's very unlikely that anything more than 1 or 2 of the measurements would be identical, but it can't hurt</span></span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Sort clean.iris in the same way</span></span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a>clean.iris <span class="ot">&lt;-</span> clean.iris <span class="sc">%&gt;%</span></span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(Species, Sepal.Length, Sepal.Width, Petal.Length, Petal.Width)</span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-14"><a href="#cb65-14" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(sorted.iris)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Sepal.Length Sepal.Width Petal.Length Petal.Width Species
1          4.3         3.0          1.1         0.1  setosa
2          4.4         2.9          1.4         0.2  setosa
3          4.4         3.0          1.3         0.2  setosa
4          4.4         3.2          1.3         0.2  setosa
5          4.5         2.3          1.3         0.3  setosa
6          4.6         3.1          1.5         0.2  setosa</code></pre>
</div>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(clean.iris)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 5
  Sepal.Length     Sepal.Width      Petal.Length     Petal.Width       Species
  &lt;chr&gt;            &lt;chr&gt;            &lt;chr&gt;            &lt;chr&gt;             &lt;fct&gt;  
1 4,25660729576833 2,97086414169753 1,12879785496742 0,13043260396691  setosa 
2 4,38115143395495 2,90909694038099 1,38890282164095 0,235692814656068 setosa 
3 4,40556099674664 3,22324654717231 1,30889431589749 0,205201828696299 setosa 
4 4,42615761818597 3,02298005308956 1,29228728198912 0,164897404590156 setosa 
5 4,46317811898421 2,26448698512046 1,26988187949872 0,328616009263787 setosa 
6 4,55285815886687 3,60524568493012 1,02354059573496 0,156507294801995 setosa </code></pre>
</div>
</div>
<p>At least the first few rows look comparable now. We know we’ll need to round the measurements, and that would make all the values we see here match.</p>
</section>
<section id="compare" class="level4">
<h4 class="anchored" data-anchor-id="compare">Compare</h4>
<p>Let’s compare the two datasets:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: checkpoint-2-compare</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a><span class="fu">all.equal</span>(clean.iris, sorted.iris)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "Attributes: &lt; Component \"class\": Lengths (3, 1) differ (string compare on first 1) &gt;"
 [2] "Attributes: &lt; Component \"class\": 1 string mismatch &gt;"                                
 [3] "Component \"Sepal.Length\": Modes: character, numeric"                                 
 [4] "Component \"Sepal.Length\": target is character, current is numeric"                   
 [5] "Component \"Sepal.Width\": Modes: character, numeric"                                  
 [6] "Component \"Sepal.Width\": target is character, current is numeric"                    
 [7] "Component \"Petal.Length\": Modes: character, numeric"                                 
 [8] "Component \"Petal.Length\": target is character, current is numeric"                   
 [9] "Component \"Petal.Width\": Modes: character, numeric"                                  
[10] "Component \"Petal.Width\": target is character, current is numeric"                    </code></pre>
</div>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">render_diff</span>(<span class="fu">diff_data</span>(clean.iris, sorted.iris))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We checked off a few more problems from the <code>all.equal()</code> errors. We’re down to 10 flagged differences. Most of them have to do with data types for the measurement columns, so let’s tackle that next.</p>
</section>
</section>
<section id="clean-numeric-values" class="level3">
<h3 class="anchored" data-anchor-id="clean-numeric-values">Clean numeric values</h3>
<p>We’ve got three things to address in the measurement columns:</p>
<ol type="1">
<li>Commas instead of periods</li>
<li>Data types should be numeric, not character</li>
<li>Numbers not rounded to the same number of decimal places</li>
</ol>
<p>Like with the rename/reorder bit at the beginning, there are multiple ways to approach these.</p>
<section id="three-step-method" class="level4">
<h4 class="anchored" data-anchor-id="three-step-method">Three-step method</h4>
<p>One way is to just go down the line solving each problem one at a time. First we need to plan out the order. We know to accomplish (1) we need to keep the columns as characters, but for (3) we need to convert them to numeric. So we should do them in the order 1-2-3 (huh, how terribly convenient).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: clean-numeric-three-step</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Make a copy of the dataset to work with, just for the purposes of trying out the two different methods</span></span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>clean.iris<span class="fl">.3</span>step <span class="ot">&lt;-</span> clean.iris <span class="sc">%&gt;%</span> </span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Replace commas with periods</span></span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">Sepal.Length =</span> <span class="fu">str_replace_all</span>(Sepal.Length, <span class="st">","</span>, <span class="st">"."</span>),</span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">Sepal.Width =</span> <span class="fu">str_replace_all</span>(Sepal.Width, <span class="st">","</span>, <span class="st">"."</span>),</span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a>        <span class="at">Petal.Length =</span> <span class="fu">str_replace_all</span>(Petal.Length, <span class="st">","</span>, <span class="st">"."</span>),</span>
<span id="cb72-11"><a href="#cb72-11" aria-hidden="true" tabindex="-1"></a>        <span class="at">Petal.Width =</span> <span class="fu">str_replace_all</span>(Petal.Width, <span class="st">","</span>, <span class="st">"."</span>)</span>
<span id="cb72-12"><a href="#cb72-12" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb72-13"><a href="#cb72-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert to numeric</span></span>
<span id="cb72-14"><a href="#cb72-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb72-15"><a href="#cb72-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">Sepal.Length =</span> <span class="fu">as.numeric</span>(Sepal.Length),</span>
<span id="cb72-16"><a href="#cb72-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">Sepal.Width =</span> <span class="fu">as.numeric</span>(Sepal.Width),</span>
<span id="cb72-17"><a href="#cb72-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">Petal.Length =</span> <span class="fu">as.numeric</span>(Petal.Length),</span>
<span id="cb72-18"><a href="#cb72-18" aria-hidden="true" tabindex="-1"></a>        <span class="at">Petal.Width =</span> <span class="fu">as.numeric</span>(Petal.Width)</span>
<span id="cb72-19"><a href="#cb72-19" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb72-20"><a href="#cb72-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Round to 1 decimal place</span></span>
<span id="cb72-21"><a href="#cb72-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb72-22"><a href="#cb72-22" aria-hidden="true" tabindex="-1"></a>        <span class="at">Sepal.Length =</span> <span class="fu">round</span>(Sepal.Length, <span class="dv">1</span>),</span>
<span id="cb72-23"><a href="#cb72-23" aria-hidden="true" tabindex="-1"></a>        <span class="at">Sepal.Width =</span> <span class="fu">round</span>(Sepal.Width, <span class="dv">1</span>),</span>
<span id="cb72-24"><a href="#cb72-24" aria-hidden="true" tabindex="-1"></a>        <span class="at">Petal.Length =</span> <span class="fu">round</span>(Petal.Length, <span class="dv">1</span>),</span>
<span id="cb72-25"><a href="#cb72-25" aria-hidden="true" tabindex="-1"></a>        <span class="at">Petal.Width =</span> <span class="fu">round</span>(Petal.Width, <span class="dv">1</span>)</span>
<span id="cb72-26"><a href="#cb72-26" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb72-27"><a href="#cb72-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-28"><a href="#cb72-28" aria-hidden="true" tabindex="-1"></a><span class="do">## Worth noting here that although we have mutated each variable individually, we could have done each step in just one line of code using mutate(across(...)). I'll leave you to play around and figure that out. I'd start off with the convertion to numeric; that's the simplest to implement with across().</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="one-step-method-1" class="level4">
<h4 class="anchored" data-anchor-id="one-step-method-1">One-step method</h4>
<p>We can do this all in a single mutate by using <code>parse_number()</code> from the <code>readr</code> package to convert the commas to periods and then convert the columns to numeric. This exists because not all regions use the same characters to represent decimals and “grouping” (ie the commas in one million: 1,000,000). With the <code>locale</code> argument, you can tell <code>parse_number()</code> what to treat as these characters, then it will do the job of converting to numeric with those specifications. The resulting numbers will use the period as the decimal mark, which is the standard in R.</p>
<p>To round to the tenths place we use <code>round()</code>, but instead of making this its own mutate, we just wrap the whole thing in <code>round(..., 1)</code>. R evaluates inside out, so it will do all the work for <code>parse_number()</code> first, then round the results.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: clean-numeric-one-step</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>clean.iris<span class="fl">.1</span>step <span class="ot">&lt;-</span> clean.iris <span class="sc">%&gt;%</span></span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Replace commas with periods and convert to numeric with parse_number()</span></span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>        <span class="at">Sepal.Length =</span> <span class="fu">round</span>( <span class="co"># We wrap the whole thing in round() to round to 1 decimal place</span></span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a>            <span class="fu">parse_number</span>(</span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a>                Sepal.Length, </span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a>                <span class="at">locale =</span> <span class="fu">locale</span>(<span class="at">decimal_mark =</span> <span class="st">","</span>, <span class="at">grouping_mark =</span> <span class="st">"."</span>)</span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a>            ), <span class="dv">1</span>), <span class="co"># this is the end of the round() function</span></span>
<span id="cb73-11"><a href="#cb73-11" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Do the same for the other columns</span></span>
<span id="cb73-12"><a href="#cb73-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">Sepal.Width =</span> <span class="fu">round</span>(</span>
<span id="cb73-13"><a href="#cb73-13" aria-hidden="true" tabindex="-1"></a>            <span class="fu">parse_number</span>(</span>
<span id="cb73-14"><a href="#cb73-14" aria-hidden="true" tabindex="-1"></a>                Sepal.Width, </span>
<span id="cb73-15"><a href="#cb73-15" aria-hidden="true" tabindex="-1"></a>                <span class="at">locale =</span> <span class="fu">locale</span>(<span class="at">decimal_mark =</span> <span class="st">","</span>, <span class="at">grouping_mark =</span> <span class="st">"."</span>)</span>
<span id="cb73-16"><a href="#cb73-16" aria-hidden="true" tabindex="-1"></a>            ), <span class="dv">1</span>),</span>
<span id="cb73-17"><a href="#cb73-17" aria-hidden="true" tabindex="-1"></a>        <span class="at">Petal.Length =</span> <span class="fu">round</span>(</span>
<span id="cb73-18"><a href="#cb73-18" aria-hidden="true" tabindex="-1"></a>            <span class="fu">parse_number</span>(</span>
<span id="cb73-19"><a href="#cb73-19" aria-hidden="true" tabindex="-1"></a>                Petal.Length, </span>
<span id="cb73-20"><a href="#cb73-20" aria-hidden="true" tabindex="-1"></a>                <span class="at">locale =</span> <span class="fu">locale</span>(<span class="at">decimal_mark =</span> <span class="st">","</span>, <span class="at">grouping_mark =</span> <span class="st">"."</span>)</span>
<span id="cb73-21"><a href="#cb73-21" aria-hidden="true" tabindex="-1"></a>            ), <span class="dv">1</span>),</span>
<span id="cb73-22"><a href="#cb73-22" aria-hidden="true" tabindex="-1"></a>        <span class="at">Petal.Width =</span> <span class="fu">round</span>(</span>
<span id="cb73-23"><a href="#cb73-23" aria-hidden="true" tabindex="-1"></a>            <span class="fu">parse_number</span>(</span>
<span id="cb73-24"><a href="#cb73-24" aria-hidden="true" tabindex="-1"></a>                Petal.Width, </span>
<span id="cb73-25"><a href="#cb73-25" aria-hidden="true" tabindex="-1"></a>                <span class="at">locale =</span> <span class="fu">locale</span>(<span class="at">decimal_mark =</span> <span class="st">","</span>, <span class="at">grouping_mark =</span> <span class="st">"."</span>)</span>
<span id="cb73-26"><a href="#cb73-26" aria-hidden="true" tabindex="-1"></a>            ), <span class="dv">1</span>)</span>
<span id="cb73-27"><a href="#cb73-27" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Again, we can do columns at once with <code>across()</code>. Here’s what that looks like:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: clean-numeric-across</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>clean.iris.across <span class="ot">&lt;-</span> clean.iris <span class="sc">%&gt;%</span></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>        <span class="fu">across</span>(</span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Select the columns to apply the function to</span></span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>            Sepal.Length<span class="sc">:</span>Petal.Width,</span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Apply the function to each column</span></span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a>            <span class="sc">~</span><span class="fu">round</span>(</span>
<span id="cb74-10"><a href="#cb74-10" aria-hidden="true" tabindex="-1"></a>                <span class="fu">parse_number</span>(</span>
<span id="cb74-11"><a href="#cb74-11" aria-hidden="true" tabindex="-1"></a>                    .x, </span>
<span id="cb74-12"><a href="#cb74-12" aria-hidden="true" tabindex="-1"></a>                    <span class="at">locale =</span> <span class="fu">locale</span>(<span class="at">decimal_mark =</span> <span class="st">","</span>, <span class="at">grouping_mark =</span> <span class="st">"."</span>)</span>
<span id="cb74-13"><a href="#cb74-13" aria-hidden="true" tabindex="-1"></a>                ), <span class="dv">1</span>)</span>
<span id="cb74-14"><a href="#cb74-14" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb74-15"><a href="#cb74-15" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>I am not going to explain this one in detail, but I will say that it’s a good idea to try to understand it. It’s a very powerful tool that can save you a lot of time and typing.</p>
<p>Comparing the resulting results of all three methods produces identical datasets:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: compare-numeric-methods</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a><span class="fu">all.equal</span>(clean.iris<span class="fl">.3</span>step, clean.iris<span class="fl">.1</span>step)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">all.equal</span>(clean.iris<span class="fl">.1</span>step, clean.iris.across)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Since they're all equal, pick any of the three to save as the clean.iris</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>clean.iris <span class="ot">&lt;-</span> clean.iris<span class="fl">.1</span>step</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="checkpoint-3" class="level3">
<h3 class="anchored" data-anchor-id="checkpoint-3">Checkpoint 3</h3>
<p>Let’s compare the two datasets again.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: checkpoint-3-compare</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a><span class="do">## Resort as a safety measure</span></span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a><span class="do">## See what happens if you leave this out! </span></span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a>clean.iris <span class="ot">&lt;-</span> clean.iris <span class="sc">%&gt;%</span></span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(Species, Sepal.Length, Sepal.Width, Petal.Length, Petal.Width)</span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-10"><a href="#cb80-10" aria-hidden="true" tabindex="-1"></a><span class="fu">all.equal</span>(clean.iris, sorted.iris)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Attributes: &lt; Component \"class\": Lengths (3, 1) differ (string compare on first 1) &gt;"
[2] "Attributes: &lt; Component \"class\": 1 string mismatch &gt;"                                </code></pre>
</div>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="fu">render_diff</span>(<span class="fu">diff_data</span>(clean.iris, sorted.iris))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We’re down to 6 flagged differences with <code>all.equal()</code>, but <code>diff_data()</code> disagrees! This is where it’s finally helpful. <code>all.equal()</code> is extremely sensitive. The remaining flags are about Attributes, which you can think about as meta-information for the objects.</p>
<p>If we want to dig in to figure out what these are about, start by just looking at what the attributes are. The flags we got mention “class,” so keep an eye on that.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: compare-attributes</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Check the attributes of the two datasets</span></span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a><span class="fu">attributes</span>(clean.iris)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$names
[1] "Sepal.Length" "Sepal.Width"  "Petal.Length" "Petal.Width"  "Species"     

$row.names
  [1]   1   2   3   4   5   6   7   8   9  10  11  12  13  14  15  16  17  18
 [19]  19  20  21  22  23  24  25  26  27  28  29  30  31  32  33  34  35  36
 [37]  37  38  39  40  41  42  43  44  45  46  47  48  49  50  51  52  53  54
 [55]  55  56  57  58  59  60  61  62  63  64  65  66  67  68  69  70  71  72
 [73]  73  74  75  76  77  78  79  80  81  82  83  84  85  86  87  88  89  90
 [91]  91  92  93  94  95  96  97  98  99 100 101 102 103 104 105 106 107 108
[109] 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126
[127] 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144
[145] 145 146 147 148 149 150

$class
[1] "tbl_df"     "tbl"        "data.frame"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="fu">attributes</span>(sorted.iris)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$names
[1] "Sepal.Length" "Sepal.Width"  "Petal.Length" "Petal.Width"  "Species"     

$class
[1] "data.frame"

$row.names
  [1]   1   2   3   4   5   6   7   8   9  10  11  12  13  14  15  16  17  18
 [19]  19  20  21  22  23  24  25  26  27  28  29  30  31  32  33  34  35  36
 [37]  37  38  39  40  41  42  43  44  45  46  47  48  49  50  51  52  53  54
 [55]  55  56  57  58  59  60  61  62  63  64  65  66  67  68  69  70  71  72
 [73]  73  74  75  76  77  78  79  80  81  82  83  84  85  86  87  88  89  90
 [91]  91  92  93  94  95  96  97  98  99 100 101 102 103 104 105 106 107 108
[109] 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126
[127] 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144
[145] 145 146 147 148 149 150</code></pre>
</div>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Single out the class attribute</span></span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a><span class="fu">attributes</span>(clean.iris)<span class="sc">$</span>class</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "tbl_df"     "tbl"        "data.frame"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="fu">attributes</span>(sorted.iris)<span class="sc">$</span>class</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "data.frame"</code></pre>
</div>
</div>
<p>Looks like there’s a difference in the class(es) of the objects themselves. The <code>sorted.iris</code> dataset we made is a <code>data.frame</code> (and only that!), while the <code>clean.iris</code> dataset is a <code>data.frame</code>, a <code>tbl_df</code>, and a <code>tbl</code>.</p>
<p>If you need a little reminder about tibbles and dataframes:</p>
<ul>
<li><strong>Dataframes</strong> (<code>data.frame</code>) are the base R class for tabular data.</li>
<li><strong>Tibbles</strong> (<code>tbl</code>) are a modern take on the dataframe that have some nice features, like better printing and some more helpful error messages.</li>
<li>The <code>tbl_df</code> class is a subclass of <code>tbl</code> that is used to make sure that the object is a tibble.</li>
</ul>
<p>As you’re working with data in R – especially in the tidyverse – you’ll rarely need to worry about these differences. R can usually figure out what you want to do with your data, and reclass things if needed. But it’s still technically part of the objects, and <code>all.equal()</code> is sensitive enough to pick up on it.</p>
<p>Now we make a judgment call. Do we care about this difference? If we do, we can make the two objects the same class. If we don’t, we can move on.</p>
<p>Remember that when we compared with <code>diff_data()</code>, it didn’t show any differences. As a rule of thumb, if <code>diff_data()</code> doesn’t show anything, you’re <em>probably</em> fine. It <em>probably</em> means that remaining differences are in the metadata, not the data itself.</p>
<p>If you want to be thorough about it, you can make the two objects the same class. We’ll make them both tibbles.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: make-tibbles</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Make both datasets tibbles</span></span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>clean.iris <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(clean.iris) <span class="co"># this already was a tibble, but we'll run it again to make sure</span></span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a>sorted.iris <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(sorted.iris)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we can compare the two datasets again:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: checkpoint-3-compare-2</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a><span class="fu">all.equal</span>(clean.iris, sorted.iris)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="fu">render_diff</span>(<span class="fu">diff_data</span>(clean.iris, sorted.iris))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>No differences! We’re done!</p>
<p>We should acknowledge the caveat that we just matched our <code>clean.iris</code> to the <code>sorted.iris</code> dataset, which we created from the original <code>iris</code> dataset, not to <code>iris</code>. We made the deliberate choice to slightly modify the original dataset because it would not be possible[^1] to make it easier to compare to our cleaned dataset.</p>
<p>[^1] Well, it would be possible, but not with the tools available to us that we’re using in this class. It would be a lot of work for no real benefit, but if you want to figure out how to do it as an exercise, go for it!</p>
</section>
</section>
</section>
<section id="simplify" class="level1">
<h1>Simplify</h1>
<p>We can simplify our code by combining all the cleaning steps into a single pipeline. This will make it easier to understand and maintain in the future.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: simplify-pipeline</span></span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a single pipeline to clean the messy dataset</span></span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>clean.iris<span class="fl">.1</span>pipe <span class="ot">&lt;-</span> messy.iris <span class="sc">%&gt;%</span></span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Rename columns</span></span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Sepal.Length =</span> SepalLength, <span class="at">Sepal.Width =</span> SepalWidth, <span class="at">Petal.Length =</span> PetalLength, <span class="at">Petal.Width =</span> PetalWidth, <span class="at">Species =</span> FlowerSpecies) <span class="sc">%&gt;%</span></span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Reorder columns</span></span>
<span id="cb95-8"><a href="#cb95-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(Sepal.Length, Sepal.Width, Petal.Length, Petal.Width, Species) <span class="sc">%&gt;%</span></span>
<span id="cb95-9"><a href="#cb95-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Clean Species column</span></span>
<span id="cb95-10"><a href="#cb95-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb95-11"><a href="#cb95-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">Species =</span> <span class="fu">str_squish</span>(Species),</span>
<span id="cb95-12"><a href="#cb95-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">Species =</span> <span class="fu">str_to_lower</span>(Species),</span>
<span id="cb95-13"><a href="#cb95-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">Species =</span> <span class="fu">str_replace_all</span>(Species, <span class="st">"0"</span>, <span class="st">"o"</span>),</span>
<span id="cb95-14"><a href="#cb95-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">Species =</span> <span class="fu">str_replace_all</span>(Species, <span class="st">"setsoa"</span>, <span class="st">"setosa"</span>),</span>
<span id="cb95-15"><a href="#cb95-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">Species =</span> <span class="fu">str_replace_all</span>(Species, <span class="st">"versicolour"</span>, <span class="st">"versicolor"</span>),</span>
<span id="cb95-16"><a href="#cb95-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">Species =</span> <span class="fu">str_replace_all</span>(Species, <span class="st">"virginia"</span>, <span class="st">"virginica"</span>),</span>
<span id="cb95-17"><a href="#cb95-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">Species =</span> <span class="fu">factor</span>(Species)</span>
<span id="cb95-18"><a href="#cb95-18" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb95-19"><a href="#cb95-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Clean numeric columns</span></span>
<span id="cb95-20"><a href="#cb95-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb95-21"><a href="#cb95-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">across</span>(</span>
<span id="cb95-22"><a href="#cb95-22" aria-hidden="true" tabindex="-1"></a>      Sepal.Length<span class="sc">:</span>Petal.Width,</span>
<span id="cb95-23"><a href="#cb95-23" aria-hidden="true" tabindex="-1"></a>      <span class="sc">~</span><span class="fu">round</span>(</span>
<span id="cb95-24"><a href="#cb95-24" aria-hidden="true" tabindex="-1"></a>        <span class="fu">parse_number</span>(.x, </span>
<span id="cb95-25"><a href="#cb95-25" aria-hidden="true" tabindex="-1"></a>          <span class="at">locale =</span> <span class="fu">locale</span>(<span class="at">decimal_mark =</span> <span class="st">","</span>, <span class="at">grouping_mark =</span> <span class="st">"."</span>)</span>
<span id="cb95-26"><a href="#cb95-26" aria-hidden="true" tabindex="-1"></a>        ), <span class="dv">1</span>)</span>
<span id="cb95-27"><a href="#cb95-27" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb95-28"><a href="#cb95-28" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb95-29"><a href="#cb95-29" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Sort rows</span></span>
<span id="cb95-30"><a href="#cb95-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(Species, Sepal.Length, Sepal.Width, Petal.Length, Petal.Width) <span class="sc">%&gt;%</span></span>
<span id="cb95-31"><a href="#cb95-31" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Convert to tibble</span></span>
<span id="cb95-32"><a href="#cb95-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we can compare the simplified pipeline to the <code>sorted.iris</code> dataset:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: compare-pipelines</span></span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a><span class="fu">all.equal</span>(sorted.iris, clean.iris<span class="fl">.1</span>pipe)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] TRUE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="fu">render_diff</span>(<span class="fu">diff_data</span>(sorted.iris, clean.iris<span class="fl">.1</span>pipe))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Beautiful.</p>
<p>As an exercise, identify each place the ordering differs, then theorize the reasoning behind each case.</p>
<p><strong>Omitted code.</strong> Much (most?) of the cleaning process was just diagnosing the problems and confirming solutions. This is important work, but it’s not necessary to include in the final script. The final script should be a concise, clear, and complete record of the data cleaning process.</p>
<p>Identify each piece of code that was left out of the final script. This will include entire code chunks as well as small pieces of a section that actually did make it into the final script. What was the point of running any of that code to begin why? Why isn’t it needed in the final script?</p>
<p><strong>Other changes.</strong> Other differences are smaller, like combining multiple lines of a mutate into just one with nesting or the <code>across()</code> selector function. Try to spot these as well and think through what’s happening in each case. Ultimately, however, these are examples of how there are always multiple ways to do the same thing in R. You want to develop enough knowledge to be able to parse multiple methods, but when it comes to your own coding, choose the way that makes the most sense to you!</p>
<p><strong>Notable unchanged mutate thing.</strong> One thing I decided <em>not</em> to do in this script was combine all the mutating tasks into a single <code>mutate()</code> function. Another example of where context matters. The purpose of this document is to create a clear record of the cleaning process. Keeping the <code>mutate</code>s divided up and commented separately makes the pipeline easier to process. So in this case, being verbose but clear trumps being concise but potentially confusing.</p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>